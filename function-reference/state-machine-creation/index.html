
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../bpodsystem-functions/">
      
      
        <link rel="next" href="../running-statemachine/">
      
      
      <link rel="icon" href="../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.1">
    
    
      
        <title>Creating a state machine - Bpod Wiki (dev)</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.72749a73.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.a5377069.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
      <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Aldrich">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="light-green">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#creating-a-state-machine" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Bpod Wiki (dev)" class="md-header__button md-logo" aria-label="Bpod Wiki (dev)" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/17090284?v=4" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Bpod Wiki (dev)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Creating a state machine
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="light-green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="light-green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
      </label>
    
  
</form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sanworks/Bpod_Gen2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Sanworks/Bpod_Gen2
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Bpod Wiki (dev)" class="md-nav__button md-logo" aria-label="Bpod Wiki (dev)" data-md-component="logo">
      
  <img src="https://avatars.githubusercontent.com/u/17090284?v=4" alt="logo">

    </a>
    Bpod Wiki (dev)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sanworks/Bpod_Gen2" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Sanworks/Bpod_Gen2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../user-guide/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M6.27 17.05A2.991 2.991 0 0 1 4 22c-1.66 0-3-1.34-3-3s1.34-3 3-3c.18 0 .36 0 .53.05l3.07-5.36-1.74-.99 4.09-1.12 1.12 4.09-1.74-.99-3.06 5.37M20 16c-1.3 0-2.4.84-2.82 2H11v-2l-3 3 3 3v-2h6.18c.42 1.16 1.52 2 2.82 2 1.66 0 3-1.34 3-3s-1.34-3-3-3m-8-8c.18 0 .36 0 .53-.05l3.07 5.36-1.74.99 4.09 1.12 1.12-4.09-1.74.99-3.06-5.37A2.991 2.991 0 0 0 12 2c-1.66 0-3 1.34-3 3s1.34 3 3 3Z"/></svg>
  
  <span class="md-ellipsis">
    User Guide
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_2">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    
    
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Additional guides
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Additional guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/bpod-gui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using the Bpod console
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/visual-stimulus-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integrating Bpod with visual stimuli
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
      
        
          
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12.42 5.29c-1.1-.1-2.07.71-2.17 1.82L10 10h2.82v2h-3l-.44 5.07A4.001 4.001 0 0 1 2 18.83l1.5-1.5c.33 1.05 1.46 1.64 2.5 1.3.78-.24 1.33-.93 1.4-1.74L7.82 12h-3v-2H8l.27-3.07a4.01 4.01 0 0 1 4.33-3.65c1.26.11 2.4.81 3.06 1.89l-1.5 1.5c-.25-.77-.93-1.31-1.74-1.38M22 13.65l-1.41-1.41-2.83 2.83-2.83-2.83-1.43 1.41 2.85 2.85-2.85 2.81 1.43 1.41 2.83-2.83 2.83 2.83L22 19.31l-2.83-2.81L22 13.65Z"/></svg>
  
  <span class="md-ellipsis">
    Functions
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_3">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Functions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Function Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Function Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../initialization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Initialization
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../bpodsystem-fields/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BpodSystem fields
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../bpodsystem-functions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BpodSystem functions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Creating a state machine
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Creating a state machine
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#newstatemachine" class="md-nav__link">
    NewStateMachine()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addstate" class="md-nav__link">
    AddState()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#editstate" class="md-nav__link">
    EditState()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setglobaltimer" class="md-nav__link">
    SetGlobalTimer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setglobalcounter" class="md-nav__link">
    SetGlobalCounter()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setcondition" class="md-nav__link">
    SetCondition()
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../running-statemachine/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a state machine
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../running-protocol/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Running a protocol
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../data-storage/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data storage
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../general-plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    General Plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../serial-message-setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Serial message setup
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../module-matlab-usb/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module <-> MATLAB (via USB)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../module-matlab-fsm/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Module <-> MATLAB (via FSM)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../pc-fsm-softcodes/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    USB Soft Codes, PC --> FSM
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../liquid-calibration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Liquid calibration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../updating-bpod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Updating Bpod
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../module-documentation/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 15h2v3h2v-3h2v3h2v-3h2v3h2V9h-4V6H9v3H5v9h2v-3M4.38 3h15.25A2.37 2.37 0 0 1 22 5.38v14.25A2.37 2.37 0 0 1 19.63 22H4.38A2.37 2.37 0 0 1 2 19.63V5.38C2 4.06 3.06 3 4.38 3Z"/></svg>
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_4">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Plugins
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Plugins
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/analog-input-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AnalogInputModule()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/audioplayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BpodAudioPlayer()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/dds-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DDSModule()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/hifi-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BpodHiFi()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/I2C-messenger-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    I2CMessenger()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/pulsepal-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    PulsePalModule()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/rotary-encoder-module/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    RotaryEncoderModule()
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../module-documentation/waveplayer/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    BpodWavePlayer()
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Serial Interfaces
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Serial Interfaces
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/analogue-input-module-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analog Input Module Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/audioplayer-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AudioPlayer Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/blink-module-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Blink Module Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/hifi-module-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HiFi Module Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/port-array-module-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Port Array Module Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/rotary-encoder-module-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rotary Encoder Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/valve-module-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valve Module Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/waveplayer-serial-interface/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    WavePlayer Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../serial-interfaces/fsm-serial-interface-v18/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Machine Serial Interface
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../assembly/" class="md-nav__link ">
              
  
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M2 19.63 13.43 8.2l-.71-.7 1.42-1.43L12 3.89c1.2-1.19 3.09-1.19 4.27 0l3.6 3.61-1.42 1.41h2.84l.71.71-3.55 3.59-.71-.71V9.62l-1.47 1.42-.71-.71L4.13 21.76 2 19.63Z"/></svg>
  
  <span class="md-ellipsis">
    Assembly
  </span>
  

            </a>
            
              <label class="md-nav__link " for="__nav_5">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Assembly
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Install and Update
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Install and Update
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../install-and-update/installing-bpod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing Bpod
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../user-guide/bench-testing-bpod/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bench-testing Bpod
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../install-and-update/software-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Software update
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../install-and-update/firmware-update/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Firmware update
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_3" >
        
          <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    State Machines
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_3">
            <span class="md-nav__icon md-icon"></span>
            State Machines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/state-machine-assembly-0_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Machine 0.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/state-machine-assembly-0_9-1_0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Machine 0.9 - 1.0
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/state-machine-assembly-2_3-2_4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Machine 2.3-2.4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/state-machine-assembly-2_5/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Machine 2.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/state-machine-assembly-2%2B/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    State Machine 2+
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_4" >
        
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Modules
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/analog-input-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analog Input Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/analog-output-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Analog Output Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/arduino-shield-0-5-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arduino Shield 0.5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/arduino-shield-gen2-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Arduino Shield Gen2
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/dds-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DDS Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/ethernet-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Ethernet Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/hifi-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HiFi Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/lickometer-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lickometer
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/mouse-behavior-port-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mouse Behavior Port
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/mouse-box-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mouse Box
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/neuralynx-sync-board-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bpod/Neuralynx Sync Board
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/open-ephys-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bpod/OpenEphys Sync Board
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/port-array-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Port Array Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/port-breakout-board-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Port Interface Board
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/raspberry-pi-shim-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Raspberry Pi Shim
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/rotary-encoder-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rotary Encoder Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/snes-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SNES Module
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/teensy-shield-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Teensy Shield
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../assembly/valve-driver-module-assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valve Driver Module
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    External links
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            External links
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://sanworks.io" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanworks
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://sanworks.io/forums" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Forums
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/sanworks/Bpod_Gen2" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    GitHub
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#newstatemachine" class="md-nav__link">
    NewStateMachine()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#addstate" class="md-nav__link">
    AddState()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#editstate" class="md-nav__link">
    EditState()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setglobaltimer" class="md-nav__link">
    SetGlobalTimer()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setglobalcounter" class="md-nav__link">
    SetGlobalCounter()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#setcondition" class="md-nav__link">
    SetCondition()
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/ogeesan/bpod-docs-testing/tree/main/docs/function-reference/state-machine-creation.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
    </a>
  
  


<h1 id="creating-a-state-machine">Creating a state machine</h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>More examples of state machine creation can be found in the Examples/ folder of the repository. <a href="https://github.com/sanworks/Bpod_Gen2/tree/master/Examples/State%20Machines">Examples/State Machines/</a> contains minimal (building block) examples, while <a href="https://github.com/sanworks/Bpod_Gen2/tree/master/Examples/Protocols">Examples/Protocols/</a> contains complete examples of a protocol state matrix construction.</p>
</div>
<h3 id="newstatemachine"><code>NewStateMachine()</code></h3>
<p><strong>Description</strong></p>
<p>Creates a new, empty state machine. </p>
<p>States can be added to the empty state machine description with the <code>AddState()</code> function. The state machine description returned is a struct with 21 subfields:</p>
<ul>
<li>Meta: a struct with information about the state machine (sizes of variables, precomputed for speed)</li>
<li>nStates: the number of states that have been added to the state machine</li>
<li>Manifest: a cell array listing the names of states that have been referenced by other states (though not explicitly added yet)</li>
<li>nStatesInManifest: the number of states in the manifest</li>
<li>StateNames: a cell array of strings containing the name of each state added to the state machine with <code>AddState()</code>; initialized as a 1x1 cell with the string "Placeholder"</li>
<li>InputMatrix: each row is a state, each column is an input event. The matrix specifies the new state to go to if each event occurrs in each state.</li>
<li>OutputMatrix: each row is a state, each column is an output action. The matrix specifies the value of each output action in each state.</li>
<li>StateTimerMatrix: for each state, specifies the new state to go to if the state's internal timer elapses.</li>
<li>GlobalTimerStartMatrix: each row is a state, each column is a global timer. The matrix specifies the new state to go to when the global timer starts.</li>
<li>GlobalTimerEndMatrix: each row is a state, each column is a global timer. The matrix specifies the new state to go to when the global timer elapses.</li>
<li>GlobalTimers: each column is a timer. This vector specifies the current setting of each timer in seconds.</li>
<li>GlobalCounterMatrix: each row is a state, each column is a global counter. The matrix specifies the new state to go to if the counter's threshold is exceeded.</li>
<li>GlobalCounterEvents: each column is a counter. This vector specifies the input event being counted. It defaults to 255 (no input event).</li>
<li>GlobalCounterThresholds: each column is a counter. This vector specifies the number of events recorded before each counter is exceeded.</li>
<li>GlobalCounterSet: each column is a counter. This vector specifies whether each counter was used in the current matrix (1) or not (0).</li>
<li>ConditionMatrix: each row is a state, each column is a configurable input channel condition. The matrix specifies the new state to go to if the condition is satisfied.</li>
<li>ConditionChannels: The input channel index linked to each condition.</li>
<li>ConditionValues: The value of the input channel (specified in ConditionChannels) for each condition to be satisfied.</li>
<li>StateTimers: each column is a state. This vector specifies the setting of each state's internal timer in seconds.</li>
<li>StatesDefined: each column is a state. States appear in the matrix as blank states when first referred to as the target of a state transition. StatesDefined is then set from 0 to 1 when the state is finally added.</li>
</ul>
<p><strong>Syntax</strong></p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">StateMachine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span></code></pre></div>
<p><strong>Parameters</strong></p>
<ul>
<li>None</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>An empty state machine struct</li>
</ul>
<p><strong>Example</strong></p>
<p>This code initializes a state matrix and then adds one state:</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;MyState&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
</span></code></pre></div>
<h3 id="addstate"><code>AddState()</code></h3>
<p><strong>Description</strong></p>
<p>Adds a state to an existing state machine. </p>
<p><strong>Syntax</strong></p>
<p><div class="language-matlab highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">NewStateMachine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">StateMachineStruct</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">StateName</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">TimerDuration</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Conditions</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">Actions</span><span class="p">)</span>
</span></code></pre></div>
<strong>Parameters</strong></p>
<ul>
<li>StateMachineStruct: The state machine you are adding to. If this is the first state, StateMachineStruct is the output of <code>NewStateMachine()</code>.</li>
<li>StateName: A character string containing the unique name of the state.<ul>
<li>The state will automatically be assigned a number for internal use and state synchronization via the sync port.</li>
</ul>
</li>
<li>Timer: The state timer value, given in seconds<ul>
<li>This value must be zero or positive, and can range between 0-3600s.</li>
<li>If set to 0s and linked to a state transition (see next bullet), the state will still take ~100us to execute the state's output actions before the transition completes.</li>
</ul>
</li>
<li>StateChangeConditions: A cell array of strings listing pairs of input events and the state changes they trigger.<ul>
<li>Each odd cell should contain the name of a valid input event.</li>
<li>Each even cell should contain the name of the new state to enter if the previously listed event occurs, or 'exit' to exit the matrix and return all captured data..</li>
</ul>
</li>
<li>OutputActions: A cell array listing the output actions and corresponding values for the current state.<ul>
<li>Each odd cell should contain the name of a valid output action.</li>
<li>Each even cell should contain the value of the previously listed output action (see output actions for valid values).</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>A state machine struct, updated with the new state.</li>
</ul>
<p><strong>Examples</strong></p>
<p>This code generates a simple state matrix that drives BNC output channel 1 to 5V (high) for 1 second before exiting. 
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;MyState&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span><span class="c"> </span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;BNCState&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span><span class="w"> </span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="c">% Tup occurs when the state&#39;s internal timer elapses</span>
</span></code></pre></div></p>
<p>This code generates a simple state matrix that flashes the port LEDs of ports 1-3 for 0.1 second each (assuming an LED is connected to the port's PWM line). 
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LightPort1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LightPort2&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span><span class="w"> </span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LightPort2&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LightPort3&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span><span class="w"> </span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;LightPort3&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">0.1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM3&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span><span class="w"> </span>
</span></code></pre></div></p>
<h3 id="editstate"><code>EditState()</code></h3>
<p><strong>Description</strong></p>
<p>Edits a state in an existing state machine. </p>
<p><strong>Syntax</strong></p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">NewMatrix</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">EditState</span><span class="p">(</span><span class="n">StateMachineStruct</span><span class="p">,</span><span class="w"> </span><span class="n">StateName</span><span class="p">,</span><span class="w"> </span><span class="n">ParameterName</span><span class="p">,</span><span class="w"> </span><span class="n">ParameterValue</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Parameters</strong></p>
<ul>
<li>StateMachineStruct: The state machine you are editing.</li>
<li>StateName: A character string specifying the name of the state you are editing.</li>
<li>ParameterName: A character string specifying the parameter you are editing. Valid values are:<ul>
<li>'Timer'</li>
<li>'StateChangeConditions'</li>
<li>'OutputActions'</li>
</ul>
</li>
<li>ParameterValue: The new value of the parameter.<ul>
<li>For timer, this is the new timer duration in seconds. </li>
<li>For StateChangeConditions, this is a cell array of strings formatted with pair-wise arguments as in <code>AddState()</code>.</li>
<li>For OutputActions, this is a cell array of strings formatted with pair-wise arguments as in <code>AddState()</code>.</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>A state machine struct, updated with the new parameter.</li>
</ul>
<p><strong>Example</strong></p>
<p>This code generates a simple state machine that drives BNC output channel 1 to 5V (high) for 1 second before exiting. Next, EditState is used to make the state high for 10 seconds instead of 1. Finally, EditState is used to make the state machine end immediately if BNC input channel 1 receives a trigger pulse during the 10 second state.</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;MyState&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;BNCState&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span><span class="w"> </span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">EditState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;MyState&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p">);</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">EditState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;MyState&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">                     </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;BNC1High&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">);</span>
</span></code></pre></div>
<h3 id="setglobaltimer"><code>SetGlobalTimer()</code></h3>
<p><strong>Description</strong></p>
<p>Sets the parameters of a global timer.</p>
<ul>
<li>Unlike state timers, global timers can be triggered from any state (as an output action), and handled from any state (by causing a state change). Any subset of global timers can be triggered or canceled from any state.</li>
<li>An optional onset latency can be configured, following the timer trigger</li>
<li>Following the onset latency, a "start" event is generated, and can trigger a state change.</li>
<li>Then, following the timer duration, an "end" event is generated, which can also trigger a state change.</li>
<li>A digital or PWM (LED) output channel can be linked to the timer. <ul>
<li>The linked channel is set "high" when the timer starts, and "low" when it ends. PWM values may be specified for onset/offset. </li>
</ul>
</li>
<li>Separate serial output messages can be linked to the timer start and end events to control modules. </li>
<li>Global timers can be set to 'Loop'; repeat until they are explicitly canceled, or until a fixed number of iterations.<ul>
<li>Each loop iteration generates a start and stop event (this can be disabled for high-frequency loops)</li>
<li>A configurable interval separates loop iterations (default = 0 seconds)</li>
</ul>
</li>
<li>Global timers can be linked to trigger other global timers. Following the timer's onset delay, any linked timers will be triggered.</li>
<li>The number of available global timers is a configurable parameter specified in the state machine firmware.</li>
</ul>
<p><strong>Syntax</strong></p>
<p>The function uses argument-value pairs. These must be listed in order (for efficiency), up to the last argument you need. Beyond that, optional arguments (denoted by [ ]) may be omitted):</p>
<p><div class="language-matlab highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">NewStateMachine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetGlobalTimer</span><span class="p">(</span><span class="n">StateMachineStruct</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;TimerID&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">TimerNumber</span><span class="p">,</span><span class="k">...</span><span class="c"> </span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">        </span><span class="s">&#39;Duration&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">TimerDuration</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;OnsetDelay&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">OnsetDelay</span><span class="p">],</span><span class="k">...</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">        </span><span class="p">[</span><span class="s">&#39;Channel&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">OutputChannel</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;OnsetValue&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">OnsetValue</span><span class="p">],</span><span class="k">...</span><span class="c"> </span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="p">[</span><span class="s">&#39;OffsetValue&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">OffsetValue</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;Loop&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">LoopMode</span><span class="p">],</span><span class="k">...</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="w">        </span><span class="p">[</span><span class="s">&#39;GlobalTimerEvents&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">EventsEnabled</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="s">&#39;LoopInterval&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">LoopInterval</span><span class="p">],</span><span class="k">...</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">        </span><span class="p">[</span><span class="s">&#39;OnsetTrigger&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">OnsetTriggerByte</span><span class="p">])</span>
</span></code></pre></div>
where [ ] = optional argument</p>
<!-- Check syntax docs to see if there's a better way of indicating optional argument -->

<p><strong>Parameters</strong></p>
<ul>
<li>StateMachineStruct: The state machine description whose global timer you are setting (typically named 'sma').</li>
<li>TimerNumber: The number of the timer you are setting (an integer, 1-5).</li>
<li>TimerDuration: The duration of the timer, following timer start (0-3600 seconds)</li>
<li>OnsetDelay: A fixed interval following timer trigger, before the timer start event (default = 0 seconds) <ul>
<li>If set to 0, the timer starts immediately on trigger and no separate start event is generated.</li>
</ul>
</li>
<li>OutputChannel: A string specifying an output channel to link to the timer (default = none)<ul>
<li>Valid output channels can be viewed from the "inspect" icon on the Bpod Console.</li>
</ul>
</li>
<li>OnsetValue: The value to write to the output channel on timer start (default = none)<ul>
<li>If the linked output channel is a digital output (BNC, Wire), set to 1 = High; 5V or 0 = Low, 0V</li>
<li>If the linked output channel is a pulse width modulated line (port LED), set between 0-255.</li>
<li>If the linked output channel is a serial module, OnsetValue specifies a byte message to send on timer start.</li>
</ul>
</li>
<li>OffsetValue: The value to write to the output channel on timer end (default = none)</li>
<li>LoopMode: 0 = off (default). If set to 1, global timer loops until canceled or until trial end. If &gt;1, indicates a fixed number of loop iterations to execute (up to 255).</li>
<li>EventsEnabled: 1 = on (default). If set to 0, timer onset and offset events are not generated. Disabling events is useful for cases where the global timer is rapidly cycling to control a stimulus, and would otherwise generate a huge number of ignored behavior events.</li>
<li>LoopInterval: A configurable delay between the end of a timer loop and the beginning of the next one (default = 0 seconds)</li>
<li>OnsetTrigger: A byte whose bits indicate other global timers to trigger when the timer starts (following its onset delay).<ul>
<li>Instead of an integer, the assembler will recognize a character string of 1s and 0s (i.e. '101001' to trigger timers 1,4 and 6)</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>A state machine struct, updated with the new global timer settings.</li>
</ul>
<p><strong>Examples</strong></p>
<p>The two examples below are for simple use cases. More complex global timer examples can be found in the Bpod repository: /Bpod_Gen2/Examples/State Machines/GlobalTimers/</p>
<p>This code generates a state machine that sets a global timer for 3 seconds, triggers it in the first state, and handles it in the second and third states. 
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetGlobalTimer</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;TimerID&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Duration&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State2&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;GlobalTimerTrig&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State2&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Port1In&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GlobalTimer1_End&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State3&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Port1Out&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GlobalTimer1_End&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
</span></code></pre></div></p>
<p>This code generates a state machine that sets global timer#2 for 2 seconds with a 1.5 second onset delay. The timer is linked to a BNC channel. The timer is triggered in the first state, and handled it in the second and third states.</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetGlobalTimer</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;TimerID&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Duration&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">                          </span><span class="s">&#39;OnsetDelay&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">1.5</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Channel&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;BNC2&#39;</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;TimerTrig&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port1Lit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;GlobalTimerTrig&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port1Lit&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">.25</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port3Lit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GlobalTimer1_End&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port3Lit&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mf">.25</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port1Lit&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GlobalTimer1_End&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM3&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span><span class="w"> </span>
</span></code></pre></div>
<h3 id="setglobalcounter"><code>SetGlobalCounter()</code></h3>
<p><strong>Description</strong></p>
<p>Sets the threshold and monitored event for one of the 5 global counters. </p>
<ul>
<li>Global counters can count instances of events, and handle when the count exceeds a threshold from any state (by triggering a state change).</li>
<li>The number of possible counters is a configurable parameter specified in the state machine firmware.</li>
<li>For more on global counters, see <a href="../../user-guide/#state-matrix">Using State Matrices</a>.</li>
</ul>
<p><strong>Syntax</strong></p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="n">NewStateMachine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetGlobalCounter</span><span class="p">(</span><span class="n">StateMachineStruct</span><span class="p">,</span><span class="w"> </span><span class="n">CounterNumber</span><span class="p">,</span><span class="w"> </span><span class="n">TargetEventName</span><span class="p">,</span><span class="w"> </span><span class="n">Threshold</span><span class="p">)</span>
</span></code></pre></div>
<p><strong>Parameters</strong></p>
<ul>
<li>StateMachineStruct: The state matrix whose global timer you are setting.</li>
<li>CounterNumber: The number of the counter you are setting (an integer, 1-5).</li>
<li>TargetEventName: The name of the event to count (a string; see Bpod Console's magnifying glass)</li>
<li>Threshold: The number of event instances to count. (an integer).</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>A state machine struct, updated with the new global counter setting.</li>
</ul>
<p><strong>Example</strong></p>
<p>This code generates a state machine that sets a global counter to count 5 BNC1High events, resets the count to 0 in the second state, and handles it in the third and fourth states. </p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">();</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetGlobalCounter</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;BNC1High&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">);</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State1&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % BNC1High Events in this state are not counted because the count will be reset.</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State2&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10" href="#__codelineno-11-10"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State2&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span><span class="c"> % This state resets the global counter.</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11" href="#__codelineno-11-11"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-11-12"><a id="__codelineno-11-12" name="__codelineno-11-12" href="#__codelineno-11-12"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State3&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-11-13"><a id="__codelineno-11-13" name="__codelineno-11-13" href="#__codelineno-11-13"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;GlobalCounterReset&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">});</span>
</span><span id="__span-11-14"><a id="__codelineno-11-14" name="__codelineno-11-14" href="#__codelineno-11-14"></a>
</span><span id="__span-11-15"><a id="__codelineno-11-15" name="__codelineno-11-15" href="#__codelineno-11-15"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State3&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-11-16"><a id="__codelineno-11-16" name="__codelineno-11-16" href="#__codelineno-11-16"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-11-17"><a id="__codelineno-11-17" name="__codelineno-11-17" href="#__codelineno-11-17"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Port1In&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State4&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GlobalCounter1_End&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-11-18"><a id="__codelineno-11-18" name="__codelineno-11-18" href="#__codelineno-11-18"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
</span><span id="__span-11-19"><a id="__codelineno-11-19" name="__codelineno-11-19" href="#__codelineno-11-19"></a>
</span><span id="__span-11-20"><a id="__codelineno-11-20" name="__codelineno-11-20" href="#__codelineno-11-20"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State4&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-11-21"><a id="__codelineno-11-21" name="__codelineno-11-21" href="#__codelineno-11-21"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-11-22"><a id="__codelineno-11-22" name="__codelineno-11-22" href="#__codelineno-11-22"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Port1Out&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;State3&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;GlobalCounter1_End&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-11-23"><a id="__codelineno-11-23" name="__codelineno-11-23" href="#__codelineno-11-23"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{});</span>
</span></code></pre></div>
<h3 id="setcondition"><code>SetCondition()</code></h3>
<p><strong>Description</strong></p>
<p>Sets an input channel condition to handle on entering a state</p>
<ul>
<li>Each condition is true if an input channel's state matches the condition's value.</li>
<li>The number of possible conditions is a configurable parameter specified in the state machine firmware.</li>
</ul>
<p><strong>Syntax</strong>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="n">NewStateMachine</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetCondition</span><span class="p">(</span><span class="n">StateMachineStruct</span><span class="p">,</span><span class="w"> </span><span class="n">ConditionNumber</span><span class="p">,</span><span class="w"> </span><span class="n">ConditionChannel</span><span class="p">,</span><span class="w"> </span><span class="n">ConditionValue</span><span class="p">)</span>
</span></code></pre></div></p>
<p><strong>Parameters</strong></p>
<ul>
<li>StateMachineStruct: The state machine description whose global timer you are setting.</li>
<li>ConditionNumber: The number of the condition you are setting (an integer).</li>
<li>ConditionChannel: The name of the input channel attached to the condition.<ul>
<li>Input channel names are listed in BpodSystem.StateMachineInfo.InputChannelNames</li>
<li>The channel can also be a global timer, indicated as 'GlobalTimerN' where N is the index of the global timer.</li>
</ul>
</li>
<li>ConditionValue: The value of the condition channel if the condition is met (1 = high, 0 = low)<ul>
<li>If using a global timer, the timer is "high" (1) between its "start" and "end" events, and 0 otherwise.</li>
</ul>
</li>
</ul>
<p><strong>Returns</strong></p>
<ul>
<li>A state machine struct, updated with the new condition description.</li>
</ul>
<p><strong>Example</strong></p>
<p>This code generates a state machine with three states. Each state lights up a behavior port. A condition is set to be valid if the IR channel of port2 is high (1). It is then used to skip state 2 if true.</p>
<div class="language-matlab highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">NewStateMachine</span><span class="p">;</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">SetCondition</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port1Light&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port2Light&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM1&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span>
</span><span id="__span-13-9"><a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>
</span><span id="__span-13-10"><a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port2Light&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-13-11"><a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-13-12"><a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port3Light&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Condition2&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port3Light&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-13-13"><a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM2&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span>
</span><span id="__span-13-14"><a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>
</span><span id="__span-13-15"><a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a><span class="n">sma</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">AddState</span><span class="p">(</span><span class="n">sma</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;Port3Light&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
</span><span id="__span-13-16"><a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a><span class="w">    </span><span class="s">&#39;Timer&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="k">...</span>
</span><span id="__span-13-17"><a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a><span class="w">    </span><span class="s">&#39;StateChangeConditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;Tup&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;exit&#39;</span><span class="p">},</span><span class="k">...</span>
</span><span id="__span-13-18"><a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a><span class="w">    </span><span class="s">&#39;OutputActions&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="s">&#39;PWM3&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">255</span><span class="p">});</span>
</span></code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.indexes", "content.action.edit"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.4e0fa4ba.min.js"></script>
      
    
  </body>
</html>